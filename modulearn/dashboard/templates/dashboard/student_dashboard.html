{% extends 'base.html' %}

{% block title %}Student Dashboard - ModuLearn{% endblock %}

{% block content %}
<div class="py-8">
  <h1 class="text-3xl font-bold mb-2">Welcome, {{ user.username }}!</h1>

  <h2 class="text-xl font-semibold mb-4 mt-6">Your Enrolled Courses</h2>

  {% if enrollments %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for enrollment in enrollments %}
        <div class="card card-hover flex flex-col p-6 h-full">
          <h5 class="text-lg font-semibold mb-1">{{ enrollment.course_instance.course.title }}</h5>
          {% if enrollment.course_instance.group_name %}
            <h6 class="text-sm text-gray-500 dark:text-gray-400 mb-2">{{ enrollment.course_instance.group_name }}</h6>
          {% endif %}
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">{{ enrollment.course_instance.course.description|truncatewords:20 }}</p>

          <!-- Progress Bar -->
          <div class="mb-3">
            <div class="progress h-2.5">
              {% with progress_pct=enrollment.course_progress.overall_progress|default:0 %}
              <div class="progress-bar bg-green-500"
                   role="progressbar"
                   style="width: {{ progress_pct|floatformat:0 }}%; min-width: 0%; display: block;"
                   aria-valuenow="{{ progress_pct|floatformat:0 }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
              {% endwith %}
            </div>
            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
              <span>Progress: {{ enrollment.course_progress.overall_progress|default:0|floatformat:1 }}%</span>
              <span>Score: {{ enrollment.course_progress.overall_score|default:0|floatformat:1 }}%</span>
            </div>
          </div>

          <!-- Course Stats -->
          <div class="mb-3">
            <small class="text-gray-500 dark:text-gray-400 text-xs">Modules Completed</small>
            <h6 class="font-semibold">{{ enrollment.course_progress.modules_completed }}/{{ enrollment.course_progress.total_modules }}</h6>
          </div>

          <div class="mt-auto">
            <a href="{% url 'courses:course_detail' instance_id=enrollment.course_instance.id %}" class="btn btn-primary w-full">View Course</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle mr-2"></i>You are not enrolled in any courses yet.
    </div>
  {% endif %}

  <div class="mt-6">
    <a href="{% url 'courses:enroll_with_code' %}" class="btn btn-success">
      <i class="bi bi-key mr-2"></i>Enroll via Code
    </a>
  </div>
</div>
{% endblock %}
